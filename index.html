<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Euler’s Method Web App</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11/dist/math.min.js"></script>
  <script src="euler.js"></script>
  <script src="script.js" defer></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 800px; margin: auto; }
    label { display: block; margin-top: 0.5rem; }
    input { width: 100%; padding: 4px; }
    button { margin-top: 1rem; padding: 6px 10px; }
    #output { margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>Euler’s Method Web App</h1>

  <label>x₀ <input id="x0" type="number" step="any" value="0"></label>
  <label>y₀ <input id="y0" type="number" step="any" value="1"></label>
  <label>x <input id="x" type="number" step="any" value="1.1"></label>
  <label>n <input id="n" type="number" value="100" min="1"></label>
  <label>Δx <input id="dx" type="text" readonly></label>
  <label>f(x,y) <input id="expr" type="text" value="-x*x*y"></label>

  <button id="run">Compute</button>
  <button id="clear" type="button">Reset</button>

  <div id="output">
    <div id="mathDisplay">Enter an expression and press Compute</div>
    <div id="yValue"></div>
  </div>

  <script>
    // Module is a Promise-based factory because we used -sMODULARIZE -sEXPORT_NAME=Module
    Module().then(mod => {
      console.log("✅ WASM initialized");
      const runEuler = mod.cwrap("run_euler", "number", ["number","number","number","number","string"]);

      function updateDx() {
        const x0 = parseFloat(document.getElementById("x0").value);
        const x = parseFloat(document.getElementById("x").value);
        const n = parseInt(document.getElementById("n").value);
        const dx = (x - x0) / n;
        document.getElementById("dx").value = isFinite(dx) ? dx.toPrecision(6) : "";
      }

      function computeEuler() {
        const x0 = parseFloat(document.getElementById("x0").value);
        const y0 = parseFloat(document.getElementById("y0").value);
        const x = parseFloat(document.getElementById("x").value);
        const n = parseInt(document.getElementById("n").value);
        const expr = document.getElementById("expr").value;

        const result = runEuler(x0, y0, x, n, expr);
        document.getElementById("yValue").textContent = `y(${x}) ≈ ${result.toPrecision(6)}`;

        const latex = `f(x,y) = ${math.parse(expr).toTex()}`;
        document.getElementById("mathDisplay").innerHTML = `$$${latex}$$`;
        MathJax.typesetPromise();
      }

      document.getElementById("run").addEventListener("click", computeEuler);
      document.getElementById("clear").addEventListener("click", () => {
        document.getElementById("x0").value = 0;
        document.getElementById("y0").value = 1;
        document.getElementById("x").value = 1.1;
        document.getElementById("n").value = 100;
        document.getElementById("expr").value = "-x*x*y";
        document.getElementById("mathDisplay").textContent = "Enter an expression and press Compute";
        document.getElementById("yValue").textContent = "";
        updateDx();
      });
      ["x0", "x", "n"].forEach(id => document.getElementById(id).addEventListener("input", updateDx));
      updateDx();
    });
  </script>
</body>
</html>
